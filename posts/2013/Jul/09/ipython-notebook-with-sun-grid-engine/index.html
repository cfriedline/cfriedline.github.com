<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>IPython notebook with Sun Grid Engine - Christopher J. Friedline, Ph.D.</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="../../../../../posts/2013/Jul/09/ipython-notebook-with-sun-grid-engine/">

        <meta name="author" content="Christopher J. Friedline" />
        <meta name="keywords" content="ipython,sge" />
        <meta name="description" content="Here at VCU, we have what some might call a high performance computing center. While this is largely true, there are many limitations to how the current system is deployed and managed. My IT background has made working around these limitations somewhat easier, though no less of a PITA. Hopefully …" />

        <meta property="og:site_name" content="Christopher J. Friedline, Ph.D." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="IPython notebook with Sun Grid Engine"/>
        <meta property="og:url" content="../../../../../posts/2013/Jul/09/ipython-notebook-with-sun-grid-engine/"/>
        <meta property="og:description" content="Here at VCU, we have what some might call a high performance computing center. While this is largely true, there are many limitations to how the current system is deployed and managed. My IT background has made working around these limitations somewhat easier, though no less of a PITA. Hopefully …"/>
        <meta property="article:published_time" content="2013-07-09" />
            <meta property="article:section" content="Blog" />
            <meta property="article:tag" content="ipython" />
            <meta property="article:tag" content="sge" />
            <meta property="article:author" content="Christopher J. Friedline" />

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@noituloveand">
        <meta name="twitter:creator" content="@noituloveand">
    <meta name="twitter:domain" content="../../../../..">


    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../../../../theme/css/bootstrap.simplex.min.css" type="text/css"/>
    <link href="../../../../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../../../../theme/css/pygments/solarizeddark.css" rel="stylesheet">
        <link href="../../../../../theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../../theme/css/style.css" type="text/css"/>

        <link href="../../../../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Christopher J. Friedline, Ph.D. ATOM Feed"/>



        <link href="../../../../../feeds/blog.atom.xml" type="application/atom+xml" rel="alternate"
              title="Christopher J. Friedline, Ph.D. Blog ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../../../../" class="navbar-brand">
Christopher J. Friedline, Ph.D.            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/funding.html">Funding</a></li>
                    <li><a href="/pages/publications.html">Publications</a></li>
                    <li><a href="/pages/contact.html">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="../../../../.." title="Christopher J. Friedline, Ph.D."><i class="fa fa-home fa-lg"></i></a></li>
                <li class="active">IPython notebook with Sun Grid&nbsp;Engine</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../../../../../posts/2013/Jul/09/ipython-notebook-with-sun-grid-engine/"
                       rel="bookmark"
                       title="Permalink to IPython notebook with Sun Grid Engine">
                        IPython notebook with Sun Grid&nbsp;Engine
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-07-09T15:55:00-04:00"> Tue 09 July 2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="../../../../../tag/ipython.html">ipython</a>
        /
	<a href="../../../../../tag/sge.html">sge</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Here at <span class="caps">VCU</span>, we have what some might call a high performance computing center. While 
this is largely true, there are many limitations to how the current system is 
deployed and managed.  My <span class="caps">IT</span> background has made working 
around these limitations somewhat easier, though no less of a <span class="caps">PITA</span>.  Hopefully, 
some of these tips can help others, as&nbsp;well.</p>
<p>For the purposes of this tutorial, I will assume that you have Python 2.7.x 
installed with IPython.  I&#8217;ve been using the fabulous Enthought Python 
Distribution (a.k.a. <span class="caps">EPD</span>) for quite some time, which gets me most of the 
way there.  As I like living on the edge, I run IPython from the git repo. However, 
the setup described here should largely be the same regardless of the version 
of IPython you choose to&nbsp;run.</p>
<p>A current limitation of IPython notebooks is that they must be served 
from a single directory, which presents an interesting paradigm with 
respect to version control.  This can be managed in multiple&nbsp;ways:</p>
<ol>
<li>Have all notebooks installed in a single folder and version 
control at the top level of the folder, including all *.ipynb&nbsp;files</li>
<li>Create a folder for each notebook and tie it to an individual running 
notebook&nbsp;process.</li>
</ol>
<p>Both of these are possible, and working with either scenario should hopefully 
be clear by the end of this document.  If not, definitely check out the 
<a href="http://ipython.org/ipython-doc/dev/config/index.html">IPython documentation</a>.  </p>
<h1>Create an IPython&nbsp;profile</h1>
<div class="highlight"><pre><span></span>ipython profile create --parallel --profile=sge
</pre></div>


<p>This will create a profile as <span class="caps">IPYTHONDIR</span>/profile_sge</p>
<h1>Edit the cluster profile&nbsp;file</h1>
<p>Open <code>ipcluster_config.py</code> and make the following&nbsp;edits:</p>
<div class="highlight"><pre><span></span>c.IPClusterEngines.engine_launcher_class = &quot;SGEEngineSetLauncher&quot;
c.IPClusterStart.controller_launcher_class = &quot;SGEControllerLauncher&quot;
</pre></div>


<p>This setting enables submitting the controller and engines as <span class="caps">SGE</span> qsub&nbsp;jobs.</p>
<h1>Edit the notebook profile&nbsp;file</h1>
<p>Open <code>ipython_notebook_config.py</code> and make the following&nbsp;edits:</p>
<div class="highlight"><pre><span></span>c.NotebookApp.password = ...
c.NotebookManager.save_script=True
</pre></div>


<p>The first line sets a password to use for the notebook.  How to do this is 
in the <a href="http://ipython.org/ipython-doc/dev/interactive/htmlnotebook.html#security">documentation</a>.
The second line saves the notebook out as a Python file for use later.  None of these are 
necessarily important for running with <span class="caps">SGE</span>, but I&#8217;m noting them here&nbsp;anyway.</p>
<h1>Hack the IPython&nbsp;frontend</h1>
<p>Our cluster setup has compute nodes which all have access to any one of several 
<span class="caps">NFS</span> mounts.  While this is somewhat of a generic setup, a <em>feature</em> which can 
result is a write delay of the controller and engine scripts that get dropped 
when starting a cluster from the notebook. To get around this, I made an edit to 
<code>lib/python2.7/site-packages/IPython/html/services/clusters/clustermanager.py</code> which 
changes <code>delay = CFloat(1., config=True,...)</code> to delay = CFloat(30., config=True,&#8230;).
This effectively will, when a cluster is initiated from the notebook, start a controller 
process via qsub, wait 30 seconds, then start the array job for the engines. This is a 
definite hack, and I&#8217;d like to see it implemented as a feature sometime in the future. I 
should probably file a&nbsp;bug&#8230;</p>
<p><strong>Note</strong>: The previous location for this setting (0.13.x - ?) was here:
<code>lib/python2.7/site-packages/IPython/frontend/html/notebook/clustermanager.py</code></p>
<h1>Create scripts to start the&nbsp;job</h1>
<p>I created two scripts to start the notebook process on the&nbsp;cluster.</p>
<p><code>notebook_qsub.sh</code></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
qsub -cwd -V -N inotebook start_notebook.sh
</pre></div>
</td></tr></table>

<p><code>start_notebook.sh</code></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
ipython notebook --pylab inline --no-browser --profile<span class="o">=</span>sge
</pre></div>
</td></tr></table>

<p>I put both of these scripts in the folder which will house my notebooks (see options 
above), make them both executable (<code>chmod +x</code>).  Because I&#8217;m passing <code>-cwd</code>, these scripts 
will operate from the current working directory (i.e., where the ipynb files&nbsp;are).  </p>
<h1>Start the&nbsp;notebook</h1>
<p>Starting the notebook is simple now.  I just cd to the directory where the notebooks are 
and run <code>./notebook_qub.sh</code>.  Assuming all goes well, I should now have my notebook process, 
named &#8220;inotebook&#8221;, showing up when running <code>qstat</code>.</p>
<h1>Connect to the&nbsp;notebook</h1>
<p>Unfortunately, the notebook process will now be running on a compute node, which is not accessible 
from the outside network.  To enable access from my machine, I do a little <span class="caps">SSH</span> tunneling magic.  It 
goes like&nbsp;this:</p>
<p>Open up your .ssh/config and make the following&nbsp;edits</p>
<div class="highlight"><pre><span></span>Host &lt;submitnode&gt;
User &lt;username&gt;
HostName &lt;fully.qualified.domain.name.of.submitnode&gt;

Host &lt;computenode&gt;
User &lt;username&gt;
ProxyCommand ssh &lt;submitnode&gt; -W %h:22
LocalForward localhost:8888 localhost:8888
</pre></div>


<p>This will enable you to <code>ssh &lt;computenode&gt;</code> and tunnel the connection through the <code>&lt;submitnode&gt;</code> to which 
you already have access.  The port will be forwarded, through, as well, so all you need to do is now is fire-up 
your favorite, websocket-enabled browser, and hit <code>http://localhost:8888</code>. You should now also be able to go the Clusters tab and fire up a cluster.  If you <code>watch qstat</code>, you should see 
the controller job start, wait, and then the engines will&nbsp;start.    </p>
<p>I&#8217;m definitely making some assumptions here about architecture and that <span class="caps">SSH</span> forwarding is enabled in your 
environment. Your mileage may vary, but I hope this gives a good overview of what my process looks like. 
More about this problem can be found on my 
<a href="http://stackoverflow.com/questions/15376992/starting-an-ipython-cluster-from-the-notebook-with-a-delay">StackExchange post</a>.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="../../../../../posts/2015/Mar/25/winter-school-in-weggis/">Winter school in&nbsp;Weggis</a></li>
        <li><a href="../../../../../posts/2013/Jul/10/managing-ipython-notebooks-with-github/">Managing IPython notebooks with&nbsp;GitHub</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="http://www.bitbucket.org/cfriedline"><i class="fa fa-bitbucket-square fa-lg"></i> Bitbucket</a></li>
    <li class="list-group-item"><a href="http://github.com/cfriedline"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
    <li class="list-group-item"><a href="http://twitter.com/noituloveand"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
    <li class="list-group-item"><a href="http://www.linkedin.com/in/friedline"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="../../../../../"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/bnfo.html">bnfo</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/collaborate.html">collaborate</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../../../../../tag/evolution.html">evolution</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/facepalm.html">facepalm</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/field.html">field</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../../../../../tag/git.html">git</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/gore.html">gore</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="../../../../../tag/ipython.html">ipython</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/lab.html">lab</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/latex.html">latex</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/loblolly.html">loblolly</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/longleaf.html">longleaf</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/math.html">math</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/microbiome.html">microbiome</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/nsf.html">nsf</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../../../../../tag/openscience.html">openscience</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/paper.html">paper</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/papers.html">papers</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/permits.html">permits</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/publications.html">publications</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/rant.html">rant</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/science.html">science</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/sge.html">sge</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/sql.html">sql</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="../../../../../tag/swcarpentry.html">swcarpentry</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/talks.html">talks</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="../../../../../tag/teaching.html">teaching</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="../../../../../tag/travel.html">travel</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Twitter Timeline -->
<li class="list-group-item">
  <h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4>
  <div id="twitter_timeline">
    <a class="twitter-timeline" data-width="250" data-height="300" data-dnt="true" data-theme="light" href="https://twitter.com/noituloveand">Tweets by noituloveand</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</li>
<!-- End Sidebar/Twitter Timeline -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://eckertlab.blogspot.com/" target="_blank">Eckert Lab</a>
    </li>
    <li class="list-group-item">
      <a href="http://riveralab.bio.vcu.edu/" target="_blank">Rivera Lab</a>
    </li>
    <li class="list-group-item">
      <a href="http://www.biology.vcu.edu" target="_blank">VCU Biology</a>
    </li>
    <li class="list-group-item">
      <a href="http://evolfri.blogspot.com" target="_blank">Evol.Fri</a>
    </li>
    <li class="list-group-item">
      <a href="http://www.software-carpentry.org" target="_blank">Software Carpentry</a>
    </li>
    <li class="list-group-item">
      <a href="http://phylogenomics.blogspot.com" target="_blank">The Tree of Life</a>
    </li>
    <li class="list-group-item">
      <a href="http://ivory.idyll.org/blog" target="_blank">Living in an Ivory Basement</a>
    </li>
    <li class="list-group-item">
      <a href="http://phenomena.nationalgeographic.com/blog/the-loom/" target="_blank">The Loom</a>
    </li>
    <li class="list-group-item">
      <a href="http://treethinkers.blogspot.com" target="_blank">Dechronization</a>
    </li>
    <li class="list-group-item">
      <a href="http://treethinkers.org/blog/" target="_blank">TreeThinkers</a>
    </li>
    <li class="list-group-item">
      <a href="http://haldanessieve.org" target="_blank">Haldane's Sieve</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Christopher J. Friedline
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.en">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../../../../../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../../../../../theme/js/respond.min.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-42131442-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->


        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53d5b428043a2c47"></script>
</body>
</html>